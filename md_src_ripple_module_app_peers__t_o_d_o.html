<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>RippleD: Peer.cpp</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="LogoForDocumentation.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">RippleD
   </div>
   <div id="projectbrief">Ed&#39;s Take On RippleD</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Peer.cpp </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><ul>
<li>Move magic number constants into Tuning.h / Peer constants enum</li>
<li>Wrap lines to 80 columns</li>
<li>Use Journal</li>
<li>Pass Journal in the ctor argument list</li>
<li>Use m_socket-&gt;remote_endpoint() instead of m_remoteAddress in all cases. For async_connect pass the IPAddress in the bind to onConnect completion handler (so we know the address if the connect fails). For PROXY, to recover the original remote address (of the ELB) use m_socket-&gt;next_layer()-&gt;remote_endpoint(), and use m_socket-&gt;remote_endpoint() to get the "real IP" reported in the PROXY handshake.</li>
<li>Handle operation_aborted correctly, work with Peers.cpp to properly handle a stop. Peers need to be gracefully disconnected, the listening socket closed on the stop to prevent new connections (and new connections that slip through should be refused). The Peers object needs to know when the last Peer has finished closing either gracefully or from an expired graceful close timer.</li>
<li>Handle graceful connection closure (With a graceful close timeout). During a graceful close, throttle incoming data (by not issuing new socket reads), discard any received messages, drain the outbound queue, and tear down the socket when the last send completes.</li>
<li>PeerImp should construct with the socket, using a move-assign or swap. PeerDoor should not have to create a Peer object, it should just create a socket, accept the connection, and then construct the Peer object.</li>
<li>No more strings for IP addresses and ports. Always use IPAddress. We can have a version of connect() that takes a string but it should either convert it to IPAddress if its parseable, else perform a name resolution.</li>
<li>Stop calling getNativeSocket() this and that, just go through m_socket.</li>
<li>Properly handle operation_aborted in all the callbacks.</li>
<li>Move all the function definitions into the class declaration.</li>
<li>Replace macros with language constants.</li>
<li>Stop checking for exceptions, just handle errors correctly.</li>
<li>Move the business logic out of the Peer class. Socket operations and business logic should not be mixed together. We can declare a new class PeerLogic to abstract the details of message processing.</li>
<li>Change m_nodePublicKey from RippleAddress to RipplePublicKey, change the header, and modify all call sites to use the new type instead of the old. This might require adding some compatibility functions to RipplePublicKey.</li>
<li>Remove public functions that are not used outside of Peer.cpp</li>
</ul>
<h1>Peers.cpp</h1>
<ul>
<li>Add Peer::Config instead of using getConfig() to pass in configuration data</li>
</ul>
<h1>PeerSet.cpp</h1>
<ul>
<li>Remove to cyclic dependency on InboundLedger (logging only)</li>
<li>Convert to Journal </li>
</ul>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
